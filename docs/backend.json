{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SmartLearn AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "progress": {
          "type": "array",
          "description": "Tracks the user's learning progress for each topic.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    },
    "Topic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Topic",
      "type": "object",
      "description": "Represents a learning topic (e.g., 'Learn Python').",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Topic entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the learning topic."
        },
        "createdBy": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Topic). The user who created the topic/roadmap."
        },
        "roadmap": {
          "type": "array",
          "description": "An ordered list of roadmap step IDs for this topic.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "createdBy",
        "roadmap"
      ]
    },
    "Roadmap": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Roadmap",
      "type": "object",
      "description": "Represents a step in a learning roadmap.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Roadmap entity."
        },
        "stepNumber": {
          "type": "number",
          "description": "The step number in the roadmap sequence."
        },
        "stepTitle": {
          "type": "string",
          "description": "The title of the roadmap step."
        },
        "description": {
          "type": "string",
          "description": "A description of what the step covers."
        },
        "lessons": {
          "type": "array",
          "description": "An ordered list of lesson IDs for this roadmap step.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "stepNumber",
        "stepTitle",
        "description",
        "lessons"
      ]
    },
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a single lesson within a roadmap step.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lesson entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the lesson."
        },
        "description": {
          "type": "string",
          "description": "A description of what the lesson covers."
        },
        "youtubeLink": {
          "type": "string",
          "description": "A link to a relevant YouTube video.",
          "format": "uri"
        },
        "status": {
          "type": "string",
          "description": "The current status of the lesson (To Learn, Learning, Learned)."
        },
        "testId": {
          "type": "string",
          "description": "Reference to Test. (Relationship: Lesson 1:1 Test). The ID of the test associated with this lesson."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "youtubeLink",
        "status",
        "testId"
      ]
    },
    "Test": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Test",
      "type": "object",
      "description": "Represents a test or quiz for a lesson.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Test entity."
        },
        "lessonId": {
          "type": "string",
          "description": "Reference to Lesson. (Relationship: Lesson 1:1 Test). The ID of the lesson this test belongs to."
        },
        "questions": {
          "type": "array",
          "description": "An array of question objects.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "lessonId",
        "questions"
      ]
    },
    "DailyTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyTask",
      "type": "object",
      "description": "Represents a daily learning task assigned to a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DailyTask entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N DailyTask). The ID of the user assigned the task."
        },
        "topicId": {
          "type": "string",
          "description": "Reference to Topic. (Relationship: Topic 1:N DailyTask). The ID of the topic the task belongs to."
        },
        "lessonId": {
          "type": "string",
          "description": "Reference to Lesson. (Relationship: Lesson 1:N DailyTask). The ID of the lesson the task is for."
        },
        "date": {
          "type": "string",
          "description": "The date the task is assigned for.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the daily task."
        }
      },
      "required": [
        "id",
        "userId",
        "topicId",
        "lessonId",
        "date",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com",
      "apple.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  User data is private and accessible only to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/progress",
        "definition": {
          "entityName": "progress",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Tracks the learning progress of a user for different topics. Uses path-based ownership, so access is restricted to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/topics/{topicId}",
        "definition": {
          "entityName": "Topic",
          "schema": {
            "$ref": "#/backend/entities/Topic"
          },
          "description": "Stores learning topics. Includes denormalized 'createdBy' for authorization independence.",
          "params": [
            {
              "name": "topicId",
              "description": "The unique identifier of the topic."
            }
          ]
        }
      },
      {
        "path": "/roadmaps/{roadmapId}",
        "definition": {
          "entityName": "Roadmap",
          "schema": {
            "$ref": "#/backend/entities/Roadmap"
          },
          "description": "Stores learning roadmap steps.",
          "params": [
            {
              "name": "roadmapId",
              "description": "The unique identifier of the roadmap step."
            }
          ]
        }
      },
      {
        "path": "/lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": {
            "$ref": "#/backend/entities/Lesson"
          },
          "description": "Stores individual lessons within a roadmap.",
          "params": [
            {
              "name": "lessonId",
              "description": "The unique identifier of the lesson."
            }
          ]
        }
      },
      {
        "path": "/tests/{testId}",
        "definition": {
          "entityName": "Test",
          "schema": {
            "$ref": "#/backend/entities/Test"
          },
          "description": "Stores tests associated with lessons.",
          "params": [
            {
              "name": "testId",
              "description": "The unique identifier of the test."
            }
          ]
        }
      },
      {
        "path": "/dailyTasks/{taskId}",
        "definition": {
          "entityName": "DailyTask",
          "schema": {
            "$ref": "#/backend/entities/DailyTask"
          },
          "description": "Stores daily learning tasks assigned to users. Includes denormalized 'userId', 'topicId', and 'lessonId' for authorization independence.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier of the daily task."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection used to assign admin roles to users. Existence of a document at this path grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the SmartLearn AI platform, prioritizing Authorization Independence, Clarity of Intent, and secure list operations (QAPs). It avoids hierarchical authorization dependencies (`get()` calls) by denormalizing authorization context where necessary.  It adheres to DBAC principles, relying on `request.auth.uid` for authorization and storing roles in the database, not custom claims. The structure supports the core features of the app: AI-powered roadmap generation, lesson generation, daily task assignment, AI test generation, and progress tracking. Segregation of data types into separate collections with homogeneous security postures simplifies rules. Path-based ownership is used where appropriate to maintain security and integrity of user-owned data.\n\n**Authorization Independence:** The `topics` collection denormalizes the `createdBy` field, allowing rules to check ownership without `get()` calls. The `dailyTasks` collection denormalizes `userId`, `topicId`, and `lessonId` for similar reasons, ensuring tasks can be queried and secured efficiently.\n\n**QAPs Support:** Segregation into user-owned data (e.g., `/users/{userId}/progress`) and globally accessible data (`/topics`) enables secure `list` operations.  The absence of `get()` calls in rules ensures that listing operations don't break down due to complex authorization logic. The use of a dedicated `roles_admin` collection allows for secure management of admin privileges.\n\n**Choice for DailyTasks Collection:** Daily tasks are placed in a top-level collection rather than a subcollection of users or topics. The primary reason for this architectural decision is to enable efficient querying of daily tasks across all users. Storing them as subcollections would make cross-user queries prohibitively expensive and complex.\n\nEach collection is explicitly defined with a schema reference and description to improve maintainability and debuggability."
  }
}